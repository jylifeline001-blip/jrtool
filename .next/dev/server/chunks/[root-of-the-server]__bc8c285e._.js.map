{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/work/v0-domain-expiry-checker/app/api/ssl/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\nimport * as tls from \"tls\"\r\nimport * as net from \"net\"\r\n\r\ninterface SSLCertificate {\r\n  domain: string\r\n  validFrom: string | null\r\n  validTo: string | null\r\n  daysRemaining: number | null\r\n  expired: boolean\r\n  error: string | null\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url)\r\n    const domain = searchParams.get(\"domain\")\r\n\r\n    if (!domain || typeof domain !== \"string\") {\r\n      return NextResponse.json({ error: \"Domain is required\" }, { status: 400 })\r\n    }\r\n\r\n    const cleanDomain = domain\r\n      .replace(/https?:\\/\\//g, \"\")\r\n      .replace(/^www\\./, \"\")\r\n      .split(\"/\")[0]\r\n      .toLowerCase()\r\n      .trim()\r\n\r\n    if (\r\n      !cleanDomain ||\r\n      !/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/.test(cleanDomain)\r\n    ) {\r\n      return NextResponse.json({ error: \"Invalid domain format\" }, { status: 400 })\r\n    }\r\n\r\n    const sslData = await getSSLCertificate(cleanDomain)\r\n    return NextResponse.json(sslData)\r\n  } catch (error) {\r\n    console.error(\"[v0] SSL check error:\", error)\r\n    return NextResponse.json(\r\n      {\r\n        domain: \"unknown\",\r\n        validFrom: null,\r\n        validTo: null,\r\n        daysRemaining: null,\r\n        expired: false,\r\n        error: \"Unable to fetch SSL certificate. Domain may not have HTTPS or be unreachable.\",\r\n      },\r\n      { status: 500 },\r\n    )\r\n  }\r\n}\r\n\r\nasync function getSSLCertificate(domain: string): Promise<SSLCertificate> {\r\n  return new Promise((resolve, reject) => {\r\n    const socket = net.createConnection({ host: domain, port: 443 }, () => {\r\n      const tlsSocket = tls.connect(\r\n        {\r\n          host: domain,\r\n          socket: socket,\r\n          servername: domain,\r\n          rejectUnauthorized: false,\r\n        },\r\n        () => {\r\n          const cert = tlsSocket.getPeerCertificate()\r\n\r\n          if (!cert || !cert.valid_from || !cert.valid_to) {\r\n            tlsSocket.destroy()\r\n            resolve({\r\n              domain,\r\n              validFrom: null,\r\n              validTo: null,\r\n              daysRemaining: null,\r\n              expired: false,\r\n              error: \"Unable to retrieve SSL certificate details\",\r\n            })\r\n            return\r\n          }\r\n\r\n          const validFrom = new Date(cert.valid_from)\r\n          const validTo = new Date(cert.valid_to)\r\n          const now = new Date()\r\n          const daysRemaining = Math.ceil((validTo.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))\r\n          const expired = now > validTo\r\n\r\n          tlsSocket.destroy()\r\n\r\n          resolve({\r\n            domain,\r\n            validFrom: validFrom.toISOString(),\r\n            validTo: validTo.toISOString(),\r\n            daysRemaining,\r\n            expired,\r\n            error: null,\r\n          })\r\n        },\r\n      )\r\n\r\n      tlsSocket.on(\"error\", (err) => {\r\n        socket.destroy()\r\n        tlsSocket.destroy()\r\n        resolve({\r\n          domain,\r\n          validFrom: null,\r\n          validTo: null,\r\n          daysRemaining: null,\r\n          expired: false,\r\n          error: `SSL error: ${err.message}`,\r\n        })\r\n      })\r\n    })\r\n\r\n    socket.on(\"error\", (err) => {\r\n      socket.destroy()\r\n      resolve({\r\n        domain,\r\n        validFrom: null,\r\n        validTo: null,\r\n        daysRemaining: null,\r\n        expired: false,\r\n        error: `Connection error: ${err.message}`,\r\n      })\r\n    })\r\n\r\n    // 10 second timeout\r\n    socket.setTimeout(10000, () => {\r\n      socket.destroy()\r\n      resolve({\r\n        domain,\r\n        validFrom: null,\r\n        validTo: null,\r\n        daysRemaining: null,\r\n        expired: false,\r\n        error: \"SSL check timeout\",\r\n      })\r\n    })\r\n  })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAWO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,CAAC,UAAU,OAAO,WAAW,UAAU;YACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,MAAM,cAAc,OACjB,OAAO,CAAC,gBAAgB,IACxB,OAAO,CAAC,UAAU,IAClB,KAAK,CAAC,IAAI,CAAC,EAAE,CACb,WAAW,GACX,IAAI;QAEP,IACE,CAAC,eACD,CAAC,8EAA8E,IAAI,CAAC,cACpF;YACA,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,MAAM,UAAU,MAAM,kBAAkB;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,QAAQ;YACR,WAAW;YACX,SAAS;YACT,eAAe;YACf,SAAS;YACT,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,eAAe,kBAAkB,MAAc;IAC7C,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,SAAS,mHAAoB,CAAC;YAAE,MAAM;YAAQ,MAAM;QAAI,GAAG;YAC/D,MAAM,YAAY,0GAAW,CAC3B;gBACE,MAAM;gBACN,QAAQ;gBACR,YAAY;gBACZ,oBAAoB;YACtB,GACA;gBACE,MAAM,OAAO,UAAU,kBAAkB;gBAEzC,IAAI,CAAC,QAAQ,CAAC,KAAK,UAAU,IAAI,CAAC,KAAK,QAAQ,EAAE;oBAC/C,UAAU,OAAO;oBACjB,QAAQ;wBACN;wBACA,WAAW;wBACX,SAAS;wBACT,eAAe;wBACf,SAAS;wBACT,OAAO;oBACT;oBACA;gBACF;gBAEA,MAAM,YAAY,IAAI,KAAK,KAAK,UAAU;gBAC1C,MAAM,UAAU,IAAI,KAAK,KAAK,QAAQ;gBACtC,MAAM,MAAM,IAAI;gBAChB,MAAM,gBAAgB,KAAK,IAAI,CAAC,CAAC,QAAQ,OAAO,KAAK,IAAI,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;gBAC1F,MAAM,UAAU,MAAM;gBAEtB,UAAU,OAAO;gBAEjB,QAAQ;oBACN;oBACA,WAAW,UAAU,WAAW;oBAChC,SAAS,QAAQ,WAAW;oBAC5B;oBACA;oBACA,OAAO;gBACT;YACF;YAGF,UAAU,EAAE,CAAC,SAAS,CAAC;gBACrB,OAAO,OAAO;gBACd,UAAU,OAAO;gBACjB,QAAQ;oBACN;oBACA,WAAW;oBACX,SAAS;oBACT,eAAe;oBACf,SAAS;oBACT,OAAO,CAAC,WAAW,EAAE,IAAI,OAAO,EAAE;gBACpC;YACF;QACF;QAEA,OAAO,EAAE,CAAC,SAAS,CAAC;YAClB,OAAO,OAAO;YACd,QAAQ;gBACN;gBACA,WAAW;gBACX,SAAS;gBACT,eAAe;gBACf,SAAS;gBACT,OAAO,CAAC,kBAAkB,EAAE,IAAI,OAAO,EAAE;YAC3C;QACF;QAEA,oBAAoB;QACpB,OAAO,UAAU,CAAC,OAAO;YACvB,OAAO,OAAO;YACd,QAAQ;gBACN;gBACA,WAAW;gBACX,SAAS;gBACT,eAAe;gBACf,SAAS;gBACT,OAAO;YACT;QACF;IACF;AACF"}}]
}